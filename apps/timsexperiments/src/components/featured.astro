---
import { Carousel } from "@timsexperiments/react-ui";
import { getCollection } from 'astro:content';
import { formatArticleDate } from '../utils';

const articles = await getCollection('articles');
const latest = articles
  .filter((articles) => !articles.data.isDraft)
  .sort(
    (prev, current) =>
      current.data.published.getDate() - prev.data.published.getDate(),
  )
  .slice(0, 5)
  .map((article) => ({
    ...article,
    data: {
      ...article.data,
      published: formatArticleDate(article.data.published),
    },
  }));
---

<div class="relative w-full bg-grey-800 pb-24 pt-4">
  <div class="absolute top-0 h-56 w-full bg-white"></div>
  <div class="flex w-full justify-center">
    <div
      class="relative flex h-full w-full justify-evenly rounded-2xl border-2 border-grey-50 bg-white shadow-xl md:max-w-7xl lg:w-10/12">
      <div class="relative bg-white py-12 sm:py-24">
        <div class="mx-auto px-6 lg:px-8">
          <div class="mx-auto max-w-4xl text-center">
            <h2
              class="w-full text-center font-bold tracking-tight text-grey-900 sm:text-4xl">
              Latest Discoveries
            </h2>
            <p class="mx-auto mt-2 max-w-2xl text-lg leading-8 text-grey-600">
              Explore the latest findings from Tim's lab. From software hacks to
              in-depth articles, there's always something new to discover.
            </p>
          </div>
          <Carousel items={['1', '2', '3', '4', '5']} client:only />
          <div
            class="relative mx-auto mt-16 grid auto-rows-fr grid-cols-1 gap-8 overflow-hidden sm:mt-20 lg:mx-0 lg:max-w-none lg:grid-cols-3">
            {
              latest.map((article) => (
                <article class="group relative isolate flex min-w-[256px] flex-col justify-end overflow-hidden rounded-2xl bg-grey-900 px-8 pb-8 pt-80 sm:pt-48 lg:w-[256px] lg:pt-80">
                  <img
                    src={article.data.thumbnail}
                    alt=""
                    class="absolute inset-0 -z-10 h-full w-full object-cover"
                  />
                  <div class="absolute inset-0 -z-10 bg-gradient-to-t from-grey-800 via-grey-800/50 group-hover:from-grey-900 group-hover:via-grey-900/50" />
                  <div class="absolute inset-0 -z-10 rounded-2xl ring-1 ring-inset ring-grey-900/10" />

                  <div class="flex flex-wrap items-center gap-y-1 overflow-hidden text-sm leading-6 text-grey-300">
                    <time date-time={article.data.published} class="mr-8">
                      {article.data.published}
                    </time>
                  </div>
                  <h3 class="mt-3 text-lg font-semibold leading-6 text-white">
                    <a href={`/${article.slug}`}>
                      <span class="absolute inset-0" />
                      {article.data.title}
                    </a>
                  </h3>
                </article>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
